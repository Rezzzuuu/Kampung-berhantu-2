<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üëª Kampung Berhantu - Main</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&amp;family=Crimson+Text:ital,wght@0,400;0,600;1,400&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="h-full bg-main text-gray-200">
  <div id="app" class="h-full overflow-auto">
    
<div id="navbar-placeholder"></div>
<script src="header.js"></script>
    <div class="w-full h-full">
      
      <div id="game-setup" class="h-[calc(100dvh-100px)] flex flex-col relative overflow-hidden border-t-4 border-emerald-600 bg-main">
        
        <div class="absolute inset-0 z-0 flex pointer-events-none">
            <div class="w-1/2 h-full bg-gradient-to-r from-red-950/20 to-transparent"></div>
            <div class="w-1/2 h-full bg-gradient-to-l from-emerald-950/20 to-transparent"></div>
        </div>

        <div id="setup-step-1" class="relative z-10 w-full h-full flex flex-col items-center p-6 animate-fade-in overflow-y-auto">
            
            <div class="text-center mb-8">
                <div class="text-6xl mb-2 animate-float">üìù</div>
                <h1 class="font-title text-4xl md:text-5xl font-bold text-emerald-400 tracking-widest uppercase drop-shadow-lg">Pendaftaran Penduduk</h1>
                <p class="text-gray-400 italic mt-2">Masukkan nama mangsa... eh, penduduk kampung.</p>
            </div>

            <div class="w-full max-w-xl bg-black/60 border border-emerald-900/50 p-6 rounded-xl shadow-2xl backdrop-blur-md mb-8">
                <label class="block text-xs uppercase tracking-widest text-emerald-600 font-bold mb-2">Nama Pemain</label>
                <div class="flex flex-col md:flex-row gap-3">
                    <input type="text" id="player-name" placeholder="Contoh: Pak Abu" class="flex-1 p-4 bg-black/80 border border-emerald-800 text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none text-lg rounded-lg placeholder-gray-600" onkeypress="if(event.key==='Enter')addPlayer()">
                    <button onclick="addPlayer()" class="px-8 py-4 font-bold bg-emerald-800 hover:bg-emerald-700 text-white text-sm md:text-base rounded-lg border border-emerald-600 shadow-[0_0_15px_rgba(16,185,129,0.3)] transition transform active:scale-95">
                        TAMBAH
                    </button>
                </div>
                <div class="flex justify-between items-center mt-3">
                    <span class="text-xs text-gray-500">Minima: 5 Pemain</span>
                    <span class="text-xs font-mono text-emerald-400">Jumlah: <span id="player-count-step1" class="font-bold text-white text-lg">0</span>/15</span>
                </div>
            </div>

            <div class="flex-1 w-full max-w-5xl overflow-y-auto custom-scrollbar bg-black/30 border border-white/5 rounded-xl p-4 min-h-[200px]">
                <div id="players-grid-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    <div class="col-span-full text-center text-gray-600 py-10 italic">
                        Belum ada pemain didaftarkan.
                    </div>
                </div>
            </div>

            <div class="w-full max-w-5xl mt-6 flex justify-between items-center pb-6 md:pb-0">
                <button onclick="clearAllPlayers()" class="text-red-400 hover:text-red-300 underline text-sm">Padam Semua</button>
                <button id="btn-goto-roles" onclick="goToRoleSelection()" class="px-10 py-4 bg-gray-800 text-gray-500 font-bold rounded-lg border border-gray-600 cursor-not-allowed transition-all flex items-center gap-2" disabled>
                    SETERUSNYA ‚û°Ô∏è
                </button>
            </div>
        </div>


        <div id="setup-step-2" class="hidden relative z-10 w-full h-full flex flex-col">
            
            <div class="h-16 shrink-0 bg-black/80 border-b border-white/10 flex items-center justify-between px-4 md:px-6 backdrop-blur-md z-30">
                <button onclick="backToPlayerEntry()" class="flex items-center gap-2 text-gray-400 hover:text-white transition group">
                    <span class="text-xl group-hover:-translate-x-1 transition">‚¨ÖÔ∏è</span>
                    <span class="uppercase tracking-widest text-xs font-bold hidden md:inline">Kembali</span>
                </button>

                <h2 class="font-title text-lg md:text-xl text-emerald-500 font-bold tracking-widest uppercase text-center mx-2">Agihan Watak</h2>
                
                <div class="flex items-center gap-2">
                    <div class="hidden md:flex items-center gap-4 text-xs font-mono mr-2">
                        <div class="bg-gray-800 px-3 py-1 rounded border border-gray-600">
                            Pemain: <span id="display-player-total" class="text-white font-bold">0</span>
                        </div>
                        <div class="bg-gray-800 px-3 py-1 rounded border border-gray-600">
                            Watak: <span id="display-role-total" class="text-white font-bold">0</span>
                        </div>
                    </div>
                    
                    <button onclick="fullResetGame()" class="bg-red-900/30 hover:bg-red-900 text-red-400 hover:text-white border border-red-800 px-3 py-1 rounded text-xs font-bold transition flex items-center gap-1" title="Reset Semula">
                        <span>üóëÔ∏è</span> <span class="hidden md:inline">Reset</span>
                    </button>
                </div>
            </div>

            <div class="bg-black/80 border-b border-emerald-900/50 p-2 backdrop-blur-md z-20 shrink-0">
                <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-center gap-3 md:gap-6 text-sm">
                    
                    <div class="flex items-center gap-3 bg-gray-900/50 px-4 py-2 rounded-lg border border-gray-700 w-full md:w-auto justify-between md:justify-start">
                        <span class="text-emerald-400 font-bold uppercase tracking-wider text-xs">‚è≥ Masa Bincang:</span>
                        <div class="flex items-center gap-2">
                            <input type="range" id="setting-time" min="30" max="300" step="30" value="120" 
                                class="w-24 md:w-32 accent-emerald-500 cursor-pointer"
                                oninput="document.getElementById('display-time-val').innerText = this.value + 's'">
                            <span id="display-time-val" class="font-mono text-white font-bold w-12 text-center">120s</span>
                        </div>
                    </div>

                    <label class="flex items-center justify-between md:justify-start gap-3 bg-gray-900/50 px-4 py-2 rounded-lg border border-gray-700 cursor-pointer hover:border-emerald-500 transition group w-full md:w-auto">
                        <div class="flex flex-col">
                            <span class="text-white font-bold uppercase tracking-wider text-xs group-hover:text-emerald-300 transition">üé≠ Mode Misteri</span>
                            <span class="text-[10px] text-gray-500 italic">Identiti mati dirahsiakan</span>
                        </div>
                        <div class="relative flex items-center">
                            <input type="checkbox" id="setting-anonymous" class="peer sr-only">
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-emerald-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-600"></div>
                        </div>
                    </label>

                </div>
            </div>

            <div class="flex-1 flex overflow-hidden relative justify-center bg-main">
                <div class="w-full md:w-[90%] h-full flex flex-col md:flex-row border-x border-white/5 shadow-[0_0_50px_rgba(0,0,0,0.5)] overflow-y-auto md:overflow-hidden">
                    
                    <div class="w-full md:w-1/4 p-4 flex flex-col items-center justify-center relative bg-black/60 md:border-r border-b md:border-b-0 border-red-900/30 backdrop-blur-md order-2 md:order-none min-h-[500px] md:min-h-0 shrink-0">
                         <div id="evil-panel" class="hidden w-full h-full flex flex-col items-center justify-center animate-fade-in">
                            <div class="relative w-full max-w-[200px] md:max-w-[280px] aspect-[3/4] mb-4 group perspective-1000">
                                <div class="absolute -inset-2 rounded-2xl opacity-40 blur-xl bg-red-600 animate-pulse"></div>
                                <div id="evil-visual-container" class="relative w-full h-full rounded-xl overflow-hidden border-2 border-red-500/50 shadow-2xl bg-gray-900 flex items-center justify-center"></div>
                            
                            </div>
                            <div class="text-center mt-10 md:mt-8 w-full px-2">
                                <h1 id="evil-role-name" class="font-title text-2xl md:text-3xl font-bold text-red-500 mb-2 uppercase drop-shadow-lg leading-none">Nama</h1>
                                <div class="max-h-20 overflow-y-auto custom-scrollbar">
                                    <p id="evil-role-desc" class="text-sm text-red-200/70 italic leading-relaxed">...</p>
                                </div>
                            </div>
                         </div>
                         <div id="evil-panel-empty" class="text-center opacity-30">
                            <span class="text-8xl">üëπ</span>
                            <p class="text-sm mt-4 uppercase tracking-widest text-red-500 font-bold">Pilih Hantu</p>
                         </div>
                    </div>
                    
                    <div class="w-full md:w-1/4 p-2 flex flex-col md:border-r border-b md:border-b-0 border-white/10 bg-black/30 backdrop-blur-sm order-1 md:order-none min-h-[350px] md:min-h-0 shrink-0">
                        <div class="flex items-center justify-center h-12 mb-2 border-b border-red-900/30 shrink-0">
                            <h2 class="font-title text-sm font-bold text-red-500 uppercase tracking-widest text-center">Ancaman</h2>
                        </div>
                        <div id="evil-roster-setup" class="flex-1 overflow-y-auto roster-scroll space-y-2 pr-1"></div>
                    </div>
                    
                    <div class="w-full md:w-1/4 p-2 flex flex-col md:border-l border-b md:border-b-0 border-white/10 bg-black/30 backdrop-blur-sm order-3 md:order-none min-h-[350px] md:min-h-0 shrink-0">
                        <div class="flex items-center justify-center h-12 mb-2 border-b border-emerald-900/30 shrink-0">
                            <h2 class="font-title text-sm font-bold text-emerald-400 uppercase tracking-widest text-center">Harapan</h2>
                        </div>
                        <div id="good-roster-setup" class="flex-1 overflow-y-auto roster-scroll space-y-2 pl-1"></div>
                    </div>

                    <div class="w-full md:w-1/4 p-4 flex flex-col items-center justify-center relative bg-black/60 md:border-l border-emerald-900/30 backdrop-blur-md order-4 md:order-none min-h-[500px] md:min-h-0 shrink-0">
                         <div id="good-panel" class="hidden w-full h-full flex flex-col items-center justify-center animate-fade-in">
                            <div class="relative w-full max-w-[200px] md:max-w-[280px] aspect-[3/4] mb-4 group perspective-1000">
                                <div class="absolute -inset-2 rounded-2xl opacity-40 blur-xl bg-emerald-600 animate-pulse"></div>
                                <div id="good-visual-container" class="relative w-full h-full rounded-xl overflow-hidden border-2 border-emerald-500/50 shadow-2xl bg-gray-900 flex items-center justify-center"></div>
                                
                            </div>
                            <div class="text-center mt-10 md:mt-8 w-full px-2">
                                <h1 id="good-role-name" class="font-title text-2xl md:text-3xl font-bold text-emerald-400 mb-2 uppercase drop-shadow-lg leading-none">Nama</h1>
                                <div class="max-h-20 overflow-y-auto custom-scrollbar">
                                    <p id="good-role-desc" class="text-sm text-emerald-100/70 italic leading-relaxed">...</p>
                                </div>
                            </div>
                         </div>
                         <div id="good-panel-empty" class="text-center opacity-30">
                            <span class="text-8xl">üõ°Ô∏è</span>
                            <p class="text-sm mt-4 uppercase tracking-widest text-emerald-500 font-bold">Pilih Watak</p>
                         </div>
                    </div>
                </div>
            </div>

            <div class="z-30 p-4 bg-black/90 border-t border-emerald-900/50 flex justify-center items-center h-auto min-h-[12%] shrink-0">
                 <button id="start-game-btn" onclick="startGame()" disabled class="w-full md:w-1/2 px-12 py-4 font-title text-xl font-bold bg-gray-800 text-gray-500 border-2 border-gray-600 cursor-not-allowed transition-all rounded-lg flex items-center justify-center gap-3 shadow-lg">
                    <span>MULA PERMAINAN</span>
                    <span id="start-btn-status" class="text-xs bg-black/30 px-2 py-1 rounded border border-gray-500/30">0/0</span>
                 </button>
            </div>
        </div>

      </div>

      <div id="game-board" class="hidden">
        <div class="flex justify-between items-center p-3 mb-4 bg-black/40 border-b border-emerald-900/30 backdrop-blur-sm sticky top-0 z-40">
        <div class="flex items-center gap-2">
            <span class="text-xl">üëª</span>
            <span class="font-title text-xs text-gray-400 uppercase tracking-widest font-bold hidden md:inline">Kampung Berhantu</span>
        </div>
        
        <div class="flex gap-2">
            <button onclick="restartToPlayerEntry()" class="bg-blue-900/20 hover:bg-blue-900 text-blue-400 hover:text-white border border-blue-800/50 px-3 py-2 rounded-lg text-xs font-bold transition flex items-center gap-2 shadow-lg">
                <span>üë•</span> <span class="hidden md:inline">ULANG & EDIT PEMAIN</span>
            </button>

            <button onclick="fullResetGame()" class="bg-red-900/20 hover:bg-red-900 text-red-400 hover:text-white border border-red-800/50 px-3 py-2 rounded-lg text-xs font-bold transition flex items-center gap-2 shadow-lg">
                <span>üóëÔ∏è</span> <span class="hidden md:inline">TAMATKAN & RESET</span>
            </button>
        </div>
        </div>
        <div class="surface-main p-6 mb-6 text-center relative border-b-4 border-emerald-600">
          <div id="phase-icon" class="text-6xl mb-3 animate-float">üåë</div>
          <h2 id="phase-title" class="font-title text-3xl font-bold mb-1 text-emerald-100">Malam (Night)</h2>
          <p id="phase-description" class="text-lg text-emerald-400/80 italic">The village is quiet...</p>
          <div id="round-counter" class="mt-4 text-xs tracking-widest text-gray-500 uppercase">Pusingan 1</div>
        </div>

        <div id="night-summary" class="hidden surface-main p-4 mb-6 border-l-4 border-red-600 bg-red-950/20">
            <h3 class="font-bold text-red-400 mb-2">Berita Pagi Ini:</h3>
            <p id="night-summary-text" class="text-gray-200"></p>
        </div>

        <div id="discussion-section" class="hidden surface-main p-8 mb-6 border border-orange-700/50 bg-orange-950/20 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 h-1 bg-orange-600 transition-all duration-1000 ease-linear" id="timer-bar" style="width: 100%;"></div>
            <div class="mb-6 relative z-10">
                <h3 class="font-title text-xl text-orange-400 mb-2 tracking-widest uppercase">Masa Berbincang</h3>
                <p class="text-sm text-gray-400 italic">"Siapa dalangnya? Pertahankan diri anda!"</p>
            </div>
            <div class="mb-8 relative z-10">
                <div class="text-7xl font-mono font-bold text-white tracking-widest drop-shadow-[0_0_10px_rgba(234,88,12,0.5)]" id="discussion-timer">02:00</div>
                <p class="text-xs text-orange-500 mt-2 font-bold uppercase">Masa Tinggal</p>
            </div>
            <div id="discussion-leaderboard" class="mb-6 relative z-10 text-left">
                </div>
            <button onclick="skipDiscussion()" class="relative z-10 px-8 py-3 bg-gray-800 border border-gray-600 text-gray-300 hover:bg-gray-700 hover:text-white transition rounded shadow-lg mx-auto">
                ‚è© Tamatkan Perbincangan
            </button>
        </div>

        <div id="voting-section" class="hidden surface-main p-6 mb-6 border border-yellow-700/50 bg-yellow-900/10 text-center">
            <h3 class="font-title text-xl text-yellow-400 mb-4 animate-pulse">üó≥Ô∏è Proses Pengundian Sedang Dijalankan...</h3>
            <p class="text-gray-400 mb-4">Sila ikut arahan pada skrin "Pass-and-Play".</p>
            <div class="w-16 h-16 border-4 border-yellow-600 border-t-transparent rounded-full animate-spin mx-auto"></div>
        </div>

        <div class="surface-main p-6 mb-6">
          <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-2">
             <h3 class="font-title text-lg font-bold text-emerald-500">Penduduk Kampung</h3>
             <div class="flex gap-4 text-sm font-bold">
               <span class="text-emerald-400">Hidup: <span id="alive-count">0</span></span>
               <span class="text-red-500">Mati: <span id="dead-count">0</span></span>
             </div>
          </div>
          <div id="game-players-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div>
        </div>

        <div class="surface-main p-4 bg-black/40">
           <h3 class="text-xs font-bold text-gray-500 uppercase mb-2">Log Peristiwa</h3>
           <div id="game-log" class="max-h-32 overflow-y-auto space-y-1 text-xs text-gray-400 font-mono"></div>
        </div>
      </div>

      <div id="phase-transition-screen" class="hidden fixed inset-0 z-[200] flex flex-col items-center justify-center text-center transition-opacity duration-1000 bg-black">
          <div id="transition-icon" class="text-8xl mb-6 animate-bounce"></div>
          <h1 id="transition-title" class="font-title text-5xl md:text-7xl font-bold tracking-widest uppercase mb-4"></h1>
          <p id="transition-subtitle" class="text-xl md:text-2xl italic opacity-80"></p>
      </div>

      <div id="death-overlay" class="hidden fixed inset-0 z-[150] bg-black/95 flex flex-col items-center justify-center p-6 text-center">
         <div id="death-content" class="w-full max-w-md animate-pulse-glow"></div>
      </div>

      <div id="turn-overlay" class="hidden fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center p-4 text-center">
         <div id="turn-content" class="w-full max-w-lg"></div>
      </div>

      <div id="role-info-modal" class="hidden fixed inset-0 z-[200] bg-black/90 flex flex-col items-center justify-center p-6 text-center backdrop-blur-sm">
          <div class="surface-main p-8 max-w-sm w-full border-2 border-emerald-600 shadow-[0_0_30px_rgba(16,185,129,0.2)] animate-pulse-glow relative">
              <button onclick="closeRoleInfo()" class="absolute top-2 right-3 text-gray-500 hover:text-white text-xl font-bold">&times;</button>
              <h3 class="font-title text-sm text-emerald-500 tracking-widest uppercase mb-2">Maklumat Watak</h3>
              <div id="info-modal-emoji" class="text-7xl mb-4 animate-float">üëª</div>
              <h2 id="info-modal-title" class="font-title text-3xl font-bold text-white mb-4 uppercase">Nama Watak</h2>
              <div class="border-t border-b border-emerald-900/50 py-4 mb-6">
                  <p id="info-modal-desc" class="text-gray-300 italic leading-relaxed"></p>
              </div>
              <button onclick="closeRoleInfo()" class="px-8 py-2 bg-emerald-900/50 border border-emerald-600 text-emerald-100 hover:bg-emerald-800 transition w-full">Faham</button>
          </div>
      </div>

<div id="winner-announcement" class="hidden winner-modal-container animate-fade-in">
    <div class="winner-modal-content surface-main p-6 text-center relative custom-scrollbar">
        
        <div id="winner-icon" class="text-7xl mb-4 animate-bounce">üèÜ</div>
        <h2 id="winner-title" class="font-title text-4xl md:text-5xl font-bold mb-2 text-yellow-500 uppercase tracking-widest leading-none">Kemenangan!</h2>
        <p id="winner-message" class="text-lg mb-6 text-gray-300 italic font-serif">Pihak lawan telah tewas.</p>
        
        <div id="final-report-content" class="text-left mt-4 mb-6 bg-gray-900/80 rounded-lg overflow-hidden border border-gray-700">
            
            <div class="bg-yellow-900/30 p-3 border-b border-yellow-700/30">
                <h3 class="text-yellow-500 font-bold text-xs uppercase tracking-wider mb-2 flex items-center gap-2">
                    <span>üìú</span> Pendedahan Identiti
                </h3>
                <ul id="report-roles-list" class="text-xs space-y-1 text-gray-300 font-mono max-h-40 overflow-y-auto custom-scrollbar pr-2">
                    </ul>
            </div>

            <div class="bg-gray-800/30 p-3">
                <h3 class="text-gray-400 font-bold text-xs uppercase tracking-wider mb-2 flex items-center gap-2">
                    <span>‚è±Ô∏è</span> Kronologi
                </h3>
                <div id="report-timeline" class="text-[10px] text-gray-400 space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-2">
                    </div>
            </div>
        </div>

        <div class="flex flex-col gap-2 w-full">
            <button onclick="restartKeepPlayers()" class="w-full py-3 bg-emerald-800 border border-emerald-600 text-white font-bold rounded-lg shadow-lg hover:bg-emerald-700 transition flex items-center justify-center gap-2 text-sm">
                <span>üîÑ</span> MAIN SEMULA (KEKAL PEMAIN)
            </button>
            
            <div class="flex gap-2">
                <button onclick="printGameSummary()" class="flex-1 py-2 bg-gray-800 border border-gray-600 text-gray-300 hover:text-white rounded-lg text-xs font-bold">
                    üìÑ CETAK
                </button>
                <button onclick="fullResetGame()" class="flex-1 py-2 bg-red-900/40 border border-red-800 text-red-400 hover:text-white hover:bg-red-900 rounded-lg text-xs font-bold">
                    üóëÔ∏è RESET PENUH
                </button>
            </div>
        </div>

    </div>
</div>

      <div id="toast-container" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 z-[300] w-full max-w-sm px-4"></div>
      
    </div>
  </div>
  <script src="common.js"></script>
  <script src="game.js"></script>
</body>
</html>